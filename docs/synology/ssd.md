---
slug: synology-ssd-cache
keywords:
  - 黑群晖SSD缓存
  - ESXi虚拟磁盘
  - 群晖SSD缓存配置
  - DSM缓存加速
  - ESXi存储优化
  - 黑群晖性能优化
  - 群晖虚拟SSD
  - ESXi磁盘管理
  - SSD读写缓存
  - 家庭NAS优化
  - 家庭All-in-One
  - ESXi环境搭建教程
  - 陈大剩的家庭AIO服务器
  - 家庭AIO服务器
description: 详细介绍如何在ESXi环境下为黑群晖配置SSD缓存，包括虚拟磁盘创建、缓存设置、性能优化等步骤，提升家庭NAS存储性能
---

在 ESXi 虚拟化环境中为黑群晖配置 SSD 缓存是提升存储性能的有效方法。本教程将介绍如何使用 ESXi 虚拟磁盘为黑群晖创建 SSD 缓存，实现读性能的显著提升。

## SSD 缓存工作原理

### 缓存机制概述

SSD 缓存通过在高速 SSD 和传统 HDD 之间建立缓存层，将热点数据存储在 SSD 上，实现性能加速：

```
应用程序
    ↓
SSD 缓存层 ←→ 缓存命中/未命中
    ↓
传统 HDD 存储池
    ↓
物理存储设备
```

!!! info "缓存类型对比"
    - **只读缓存（Read-only）**：仅缓存读取数据，安全性高；
    - **读写缓存（Read-write）**：同时缓存读写数据，性能提升更明显；
    - **跳过顺序 I/O**：优化随机访问，避免缓存污染；

### 性能提升效果
其实群辉系统缓存比较玄学，SSD 建议开启只读缓存，这样成本很低（读写缓存需要 2 块 SSD），且安全性高（只读缓存 SSD 挂掉不影响存储空间）。

**典型性能对比**：

| 操作类型 | 纯 HDD | HDD + SSD 缓存 | 提升倍数 |
|---------|--------|----------------|----------|
| **随机读取** | 120 IOPS | 3000+ IOPS | 25x |
| **随机写入** | 80 IOPS | 1500+ IOPS | 19x |
| **文件浏览** | 2-3 秒 | 0.5 秒 | 5x |
| **应用启动** | 10-15 秒 | 3-5 秒 | 3x |

!!! tip "适用场景"
    - **媒体服务器**：频繁访问视频缩略图和元数据
    - **文件服务器**：提升文件浏览和搜索速度
    - **数据库应用**：加速数据库查询和索引操作
    - **开发环境**：提升代码编译和构建速度

## ESXi 环境准备

### 硬件要求

**SSD 选择建议**：

| 类型 | 推荐型号 | 容量建议 | 适用场景 |
|------|----------|----------|----------|
| **SATA SSD** | 三星 980、WD Blue SN570 | 256-500GB | 家庭用户，预算有限 |
| **NVMe SSD** | 三星 980 PRO、WD SN850X | 500GB-1TB | 专业用户，性能优先 |
| **企业级 SSD** | 三星 PM9A3、Intel D7-P5510 | 1TB+ | 企业应用，高耐久性 |

**容量规划原则**：

```bash
# 缓存容量计算公式
热数据量 = 总数据量 × 20% (经验值)
SSD 缓存容量 = 热数据量 × 1.5 (预留空间)

# 示例：10TB 存储系统
热数据量 = 10TB × 20% = 2TB
SSD 缓存容量 = 2TB × 1.5 = 3TB (建议配置)
实际配置 = 500GB-1TB (基于预算调整)

# 陈大剩配置
热数据量 = 4TB × 20% = 0.8TB
SSD 缓存容量 = 0.8TB × 1.5 = 1.2TB (建议配置)
实际配置 = 120GB-500GB (基于预算调整)
```

### ESXi 存储配置
## 创建 SSD 缓存虚拟磁盘
### 规划缓存磁盘
陈大剩此处是将 SN570 上分出两块虚拟硬盘，用来给 HHD 做只读缓存。
**确定缓存配置方案**：

```mermaid
graph LR
    A[存储池 1（basic）] --> D[SN570 80GB（缓存）]
    D-->B[西数 1TB]
    B --> C[存储空间 1]
     style B fill:#ff9999
```

```mermaid
graph LR
    A[存储池 2（basic）] --> D[SN570 120GB（缓存）]
    D -->B[希捷 ST2000VX008 4TB]
    B -->C[存储空间 2]
     style B fill:#ff9999
```

### 在 ESXi 中创建虚拟磁盘

**通过 vSphere Client 创建**：

=== "步骤 1：选择虚拟机"
    导航至【虚拟机和模板】，选择黑群晖虚拟机，右键点击【编辑设置】。
    ![选择虚拟机](https://img.it927.com/aio/341.png)

=== "步骤 2：添加控制器"
    点击【添加其他设备】→【NVMe 控制器】，添加控制器。
    ![添加控制器](https://img.it927.com/aio/344.png)

=== "步骤 3：添加硬盘"
    点击【添加新设备】→【硬盘】，添加新的虚拟磁盘。
    ![添加硬盘](https://img.it927.com/aio/348.png)

=== "步骤 4：配置磁盘参数"
    **关键配置项**：
    
    - **磁盘大小**：根据缓存需求设置（陈大剩这里 120GB）
    - **磁盘置备**：选择【厚置备，置零】
    - **磁盘模式**：选择【独立 - 持久】
    - **虚拟设备节点**：选择 NVMe 控制器
    
    ![配置磁盘参数](https://img.it927.com/aio/343.png)

**厚置备过程需要一定时间，此期间请勿点击打开电源**，因为陈大剩这里有两个磁盘，所以需要创建重复这个步骤两次，等待即可。
![厚置备过程](https://img.it927.com/aio/342.png)

### 验证磁盘创建
打开浏览器访问群晖管理界面，使用管理员账户登录，打开【存储管理器】既可以看到新添加了两个 SSD 盘。
![验证磁盘创建](https://img.it927.com/aio/347.png)
**检查虚拟机配置**：

```bash
# 在黑群晖 SSH 中检查新磁盘
fdisk -l | grep -E "(sd[a-z]|nvme)"

# 应该看到类似输出
Disk /dev/nvme0n1: 80 GiB, 85899345920 bytes, 167772160 sectors
Disk /dev/nvme1n1: 120 GiB, 128849018880 bytes, 251658240 sectors

# 检查磁盘类型
lsblk -f
```

**验证磁盘性能**：

```bash
# 测试顺序读取性能
dd if=/dev/nvme0n1 of=/dev/null bs=1M count=1024

# 测试随机读取性能 (需要安装 fio)
fio --filename=/dev/sdc --direct=1 --rw=randread --bs=4k --runtime=30 --name=test
```

## 配置群晖 SSD 缓存

### 访问存储管理器
**登录 DSM 系统**：打开浏览器访问群晖管理界面，使用管理员账户登录，找到【存储管理器】
![存储管理器](https://img.it927.com/aio/350.png)
### 只读缓存创建步骤
=== "步骤一：创建 SSD 缓存"
    ![存储管理器](https://img.it927.com/aio/349.png)

=== "步骤二：选择存储空间"
    ![选择存储空间](https://img.it927.com/aio/351.png)

=== "步骤三：选择缓存模式"
    ![选择缓存模式](https://img.it927.com/aio/352.png)

=== "步骤四：配置 RAID 类型"
    ![配置 RAID 类型](https://img.it927.com/aio/353.png)

=== "步骤五：选择硬盘"
    ![选择硬盘](https://img.it927.com/aio/354.png)

=== "步骤六：分配 SSD 缓存容量"
    ![分配 SSD 缓存容量](https://img.it927.com/aio/355.png)

=== "步骤七：检查设置"
    ![检查设置](https://img.it927.com/aio/356.png)

按照上述七个步骤操作完后，系统会弹出误操作确认框，直接无脑【确认即可】
![误操作确认框](https://img.it927.com/aio/357.png)
操作完成后，即可在【存储管理器】看到已经挂在的缓存，这个效果是不是很好？
![最终效果](https://img.it927.com/aio/358.png)


## 注意事项
通过合理配置 ESXi 虚拟磁盘作为 SSD 缓存，可以显著提升黑群晖的存储性能，改善用户体验。建议从只读缓存开始配置，在熟悉操作后再考虑更高级的读写缓存方案。

!!! warning "重要提醒"
    - **数据安全**：读写缓存存在数据丢失风险，重要数据必须备份；
    - **电源保护**：使用 UPS 避免断电导致缓存数据损坏；
    - **容量规划**：缓存容量过小效果有限，过大浪费资源；
    - **定期维护**：监控 SSD 健康状态，及时更换故障设备；

!!! success "配置成功标志"
    - SSD缓存创建成功并正常运行；
    - 缓存命中率稳定在 70% 以上；
    - 随机 I/O 性能显著提升；
    - 系统整体响应速度明显改善；
    - 无异常错误日志产生；

