---
slug: home-pc-windows
keywords:
  - 家庭PC虚拟机
  - ESXi Windows虚拟机
  - Windows 10虚拟化
  - Windows 11虚拟化
  - 远程桌面连接
  - RDP 远程访问
  - 家庭办公系统
  - 虚拟机GPU直通
  - Windows虚拟机优化
  - ESXi Windows性能
  - ESXi环境搭建教程
  - 陈大剩的家庭AIO服务器
description: 详细介绍如何在ESXi环境中部署Windows家庭PC虚拟机，包括硬件规划、系统安装、性能优化和故障排除，打造高效稳定的家庭办公和娱乐环境
---
根据陈大剩家庭工作区的规划，家庭中还需搭建一台高性能的 PC（Windows 虚拟机），满足家庭成员办公、游戏娱乐和开发工作的需求。
## 硬件规划
### 推荐配置
根据家庭使用需求，陈大剩建议采用 **直通存储** 和 **直通 GPU** 方案。直通存储确保即使 ESXi 主机系统出现故障，数据依然安全可靠；而 GPU 直通则便于直接连接显示器，实现独立显卡的独占使用。通过合理的硬件配置与优化设置，可获得接近物理机的高性能使用体验。

| 组件 | 推荐配置 | 最低配置 | 说明             |
|------|---------|---------|----------------|
| **CPU** | 12 vCPU | 8 vCPU | 建议选择高主频处理器     |
| **内存** | 32 GB | 16 GB | GPU 直通必须预留全部内存 |
| **存储** | 500GB NVMe SSD | 256GB SSD | 推荐直通整块物理盘      |
| **显卡** | 直通 GPU | 集成显卡 | 游戏和图形处理必备      |
| **网络** | 10 Gbps | 1 Gbps | 高速内网传输         |

### 磁盘分区规划

| 分区 | 容量 | 类型 | 作用               |
|------|------|------|------------------|
| **C:盘** | 120 GB | 系统盘 | Windows 系统及程序文件  |
| **D:盘** | 380 GB | 软件盘 | 安装软件、游戏及工作文件     |
| **E:盘** | 4 TB | 数据盘 | NAS 网络驱动器，存储重要资料 |

## 准备工作
**下载 Windows ISO 镜像**

访问 [Microsoft 官方下载页面](https://www.microsoft.com/zh-cn/software-download/)，推荐下载：**Windows 10 Pro**，下载完成后，将 ISO 文件上传到 ESXi 数据存储。
![Windows下载](https://img.it927.com/aio/370.png)

## 创建虚拟机
**导航路径**：【虚拟机】→【创建/注册虚拟机】
### 基础配置步骤
=== "步骤 1：选择创建类型"
    选择【创建新虚拟机】，使用默认设置
    
    ![选择创建类型](https://img.it927.com/aio/359.png)

=== "步骤 2：配置基本信息"
    - **名称**：输入有意义的虚拟机名称（如：Windows-PC）
    - **兼容性**：ESXi 8.0 U2 或更高版本  
    - **客户机系统**：Windows 10 (64位)
    
    ![选择名称和操作系统](https://img.it927.com/aio/360.png)

=== "步骤 3：选择存储位置"
    - **直通方式**：随意选择一个数据存储（后续会配置直通盘）
    - **虚拟磁盘方式**：选择性能最好的 SSD 数据存储
    
    ![选择存储位置](https://img.it927.com/aio/361.png)

### 自定义配置设置
以下配置步骤针对高性能需求，请根据实际情况调整参数。新手可使用默认设置。
=== "步骤 1：CPU 配置"
    - **处理器数量**：12 个 vCPU
    - **每插槽内核数**：12
    - **CPU 热添加**：可选启用（支持在线扩容）
    
    ![CPU配置](https://img.it927.com/aio/362.png)

=== "步骤 2：内存配置"
    - **内存大小**：32 GB  
    - **重要设置**：如果需要直通 PCI 设备，必须勾选【预留客户机内存(全部锁定)】
    - **内存热添加**：可选启用
    
    ![内存配置](https://img.it927.com/aio/363.png)

=== "步骤 3：清理默认设备"
    删除不需要的默认设备：

    - [x] 删除默认硬盘
    - [x] 删除 CD/DVD 驱动器  
    - [ ] 保留网络适配器
    
    ![清理默认设备](https://img.it927.com/aio/364.png)

=== "步骤 4：网络配置"
    - **网络类型**：选择【家庭终端网段】
    - **网卡类型**：推荐 VMXNET3（高性能）
    
    ![网络配置](https://img.it927.com/aio/365.png)

=== "步骤 5：添加直通设备"
    **磁盘直通配置：**

    1. 选择【添加其他设备】 → 【PCI设备】
    2. 选择目标存储设备，陈大剩这里直通一张 SN770
    3. 确保物理盘平时未被使用
    
    ![磁盘直通](https://img.it927.com/aio/367.png)


=== "步骤 6：添加 ISO 镜像"
    - **CD/DVD 驱动器**：选择“数据存储 ISO 文件”
    - **镜像文件**：选择上传的 Windows ISO
    
    ![ISO镜像配置](https://img.it927.com/aio/368.png)

### 确认最终设置

**设置启动模式**

在虚拟机选项中，将固件设置为 **EFI**（支持 UEFI 启动）

![EFI设置](https://img.it927.com/aio/379.png)

**检查配置清单**

在点击“完成”前，请确认：

- [ ] CPU 和内存配置正确
- [ ] 直通设备已添加（如需）
- [ ] ISO 镜像已挂载
- [ ] 网络配置正确
- [ ] EFI 启动已启用

![完成虚拟机创建](https://img.it927.com/aio/369.png)
## Windows 系统安装

点击【打开电源】开启 Windows 系统安装，因是保姆教程，所以介绍一下安装，Windows 安装过程相对简单，主要包括以下阶段：

### 配置引导阶段
配置引导阶段主要任务是配置引导 Windows 系统安装，顺利将 Windows 安装进磁盘中。
=== "步骤 1：等待引导"
    ![等待引导](https://img.it927.com/aio/371.png)

=== "步骤 2：安装程序启动"
    ![安装程序启动](https://img.it927.com/aio/372.png)

=== "步骤 3：现在安装"
    ![现在安装](https://img.it927.com/aio/373.png)

=== "步骤 4：激活 Windows"
    ![激活 Windows](https://img.it927.com/aio/374.png)

=== "步骤 5：选择操作系统"
    ![选择操作系统](https://img.it927.com/aio/375.png)

=== "步骤 6：接受许可协议"
    ![接受许可协议](https://img.it927.com/aio/376.png)

=== "步骤 7：选择驱动磁盘"
    这步就不多介绍，无脑操作就行
    ![选择驱动磁盘](https://img.it927.com/aio/378.png)

=== "步骤 8：安装 Windows"
    ![安装 Windows](https://img.it927.com/aio/381.png)

### 系统初始化
系统初始化阶段主要是为 Windows 系统准备操作数据，以保证安装完成后
=== "步骤 1：准备设备"
    ![准备设备](https://img.it927.com/aio/382.png)

=== "步骤 2：系统初始化"
    ![系统初始化](https://img.it927.com/aio/383.png)

=== "步骤 3：配置选择"
    选择区域记得选择【中国】，后续过程中有一些初始化选项，按需选择即可，这里不做过多的赘述
    ![系统初始化](https://img.it927.com/aio/384.png)

=== "步骤 4：准备系统"
    前步骤【配置选择】全部完成后，会进入到准备系统阶段，此阶段会多次重启系统
    ![系统初始化](https://img.it927.com/aio/385.png)

### 安装后操作
安装过程中请耐心等待，避免强制关机，不出意外，系统能顺利安装。系统安装完成后，建议立即执行以下操作：

1. **系统更新**：进入 Windows Update，安装所有可用更新
2. **驱动安装**：系统会自动安装大部分驱动程序，没有更新的手动下载驱动更新

![安装完成](https://img.it927.com/aio/386.png)
## 安装 VMware Tools
VMware Tools 是 ESXi 虚拟机的核心组件，提供驱动程序和性能优化功能，安装后可显著提升虚拟机性能和用户体验。
### 安装步骤

=== "步骤 1：新增 CD/DVD 驱动器"
    在虚拟机界面中，右键点击虚拟机 → 【编辑】→ 【添加其他设备】→ 【CD/DVD 驱动器】
    
    ![新增 CD/DVD 驱动器](https://img.it927.com/aio/388.png)

=== "步骤 2：挂载 VMware Tools"
    打开电源后，在虚拟机界面中，右键点击虚拟机 → 【客户机操作系统】→ 【安装 VMware Tools】
    
    ![挂载 VMware Tools](https://img.it927.com/aio/387.png)

=== "步骤 3：启动安装程序"
    进入 Windows 系统，打开【此电脑】，找到 VMware Tools 光驱，双击运行安装程序
    
    ![启动安装程序](https://img.it927.com/aio/389.png)

=== "步骤 4：安装向导"
    按照安装向导提示进行安装：选择【典型安装】，保持默认安装路径，等待安装完成。安装完成后，系统会提示重启，点击【是】重启虚拟机以完成安装。
    ![安装向导](https://img.it927.com/aio/390.png)

### 验证安装
重启后，VMware Tools 安装成功的标志：**鼠标可在宿主机和虚拟机间无缝切换，支持复制粘贴功能，屏幕分辨率可自动调整，网络性能得到优化**。
## 直通键鼠
键鼠直通有两种方式：[直通 USB 控制器](#usb) 和 [直通单独的鼠标键盘](#_13)。如果作为主力机使用，需要连接多个 USB 设备（U盘、键盘、鼠标等），建议选择 [直通 USB 控制器](#usb)。

### 直通 USB 控制器
主板通常使用一个 USB 控制器管理所有 USB 接口，直通该控制器即可实现所有 USB 接口的直通。

详细步骤请参见 [硬件直通 - 直通 USB 控制器](../esxi/passthrough.md#usb) 章节。注意：**直通完成后还需将设备添加到虚拟机硬件中**。
![直通 USB 控制器](https://img.it927.com/aio/396.png)

### 直通单独的鼠标键盘
如只需直通特定的鼠标或键盘，可选择单独设备直通。详细步骤请参见 [硬件直通 - 直通单独的 USB 设备](../esxi/passthrough.md#usb) 章节。

### 验证键鼠直通
直通完成后，启动虚拟机并测试键鼠操作。注意：**如果鼠标移动时光标不动，这是正常现象**，因为此时 ESXi 控制台占用了鼠标控制权。
![验证键鼠直通](https://img.it927.com/aio/397.png)

## 直通 GPU
### 启用 GPU 直通
限于篇幅的原因，这部分在前面 [硬件直通 - GPU 直通](../esxi/passthrough.md#gpu-直通显卡) 章节中有详细介绍，陈大剩我不在赘述，大家自己看前面的章节即可。

显卡切换直通后，需要将其分配给指定虚拟机：【编辑】→【添加其他设备】→【PCI 设备】，选择已直通的显卡设备（包括视频和音频控制器），保存配置并启动虚拟机。
![添加直通到虚拟机](https://img.it927.com/aio/392.png)
### 显示优化
GPU 直通后可能出现双屏显示的情况：一个是虚拟机的默认显示适配器，另一个是直通的 GPU 输出，且无法将主屏幕设为直通的 GPU 输出的屏幕。
![两个屏幕](https://img.it927.com/aio/393.png)
我们需要关掉默认显示适配器，只保留直通的 GPU 输出，可按照如下步骤进行：
=== "步骤 1：关闭虚拟机多显示器输出"
    
    【编辑虚拟机】→【虚拟机选项】→【高级】→【编辑配置】→【编辑参数】：
    ```shell
    # 将 svga.present true 改为 svga.present FALSE
    svga.present FALSE
    ```
    ![关闭虚拟机多显示器输出](https://img.it927.com/aio/402.png)

=== "步骤 2：关闭 ESXi 控制台鼠标控制权"
    【编辑虚拟机】】移除 USB 控制器
    ![移除 USB 控制器](https://img.it927.com/aio/403.png)

执行上述步骤后，点击【打开电源】，ESXi 控制台已无法观察此虚拟机的页面，仅能通过直通显卡观看，且不会有第二块屏幕占用。
![控制台](https://img.it927.com/aio/404.png)

## 其他细节优化
### 关闭系统认定虚拟机
打开任务管理器页面，发现被 Windows 系统识别为了 **虚拟机**，这怎么能忍？
![更改主力机为物理机](https://img.it927.com/aio/399.png)
点击【关闭电源】后，【编辑虚拟机】→【虚拟机选项】→【高级】→【编辑配置】→【添加参数】：
```shell
hypervisor.cpuid.v0 FALSE
```
![添加参数](https://img.it927.com/aio/400.png)
点击【打开电源】后，可看到已无虚拟机文字，证明系统已不认定为 **虚拟机**。
![结果](https://img.it927.com/aio/401.png)

